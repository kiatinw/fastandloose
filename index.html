<!-- Include Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>

<!-- HTML Container for Spectrum Chart -->
<div id="quiz-container"></div> <!-- This will hold the questions -->

<div id="result" style="margin-top: 40px;">
  <canvas id="spectrumChart" width="400" height="100"></canvas>
</div>

<!-- JavaScript for the Quiz and Chart -->
<script>
  // List of scenarios to be displayed in the quiz
  const scenarios = [
    "I never dry my cutlery—just toss it wet into the drawer.",
    "I top up my car with $5 of petrol at a time.",
    "I don’t own Tupperware. I just loosely cover leftovers with foil.",
    "I throw batteries in the regular bin.",
    "I use my partner’s toothbrush when mine is out of reach.",
    "I leave the butter out on the counter all week.",
    "I don’t check expiration dates unless it smells weird.",
    "I write appointments in pencil... on random bits of paper.",
    "I use one side of a sponge for a month, then flip it.",
    "I microwave fish at work."
  ];

  // Quiz container where questions will be inserted
  const quizContainer = document.getElementById("quiz-container");

  let currentIndex = 0; // To track the current question
  let scores = Array(scenarios.length).fill(5); // Default scores (mid-point)

  // Create the question and slider for each scenario
  function renderQuestion() {
    quizContainer.innerHTML = ''; // Clear existing content
    const questionDiv = document.createElement('div');
    questionDiv.className = 'question';

    questionDiv.innerHTML = `
      <p><strong>${currentIndex + 1}.</strong> ${scenarios[currentIndex]}</p>
      <input type="range" min="0" max="10" value="${scores[currentIndex]}" id="q${currentIndex}" />
      <span id="val${currentIndex}">${scores[currentIndex]}</span>/10 upset
      <div style="margin-top: 20px;">
        <button id="prev" ${currentIndex === 0 ? 'disabled' : ''}>Back</button>
        <button id="next" ${currentIndex === scenarios.length - 1 ? 'disabled' : ''}>Next</button>
      </div>
    `;
    
    quizContainer.appendChild(questionDiv);

    // Update value on slider change
    const slider = document.getElementById(`q${currentIndex}`);
    const valueDisplay = document.getElementById(`val${currentIndex}`);
    slider.addEventListener('input', function() {
      valueDisplay.innerText = this.value;
      scores[currentIndex] = parseInt(this.value);
    });

    // Button click handlers for navigating questions
    document.getElementById('prev').addEventListener('click', function() {
      if (currentIndex > 0) {
        currentIndex--;
        renderQuestion();
      }
    });
    
    document.getElementById('next').addEventListener('click', function() {
      if (currentIndex < scenarios.length - 1) {
        currentIndex++;
        renderQuestion();
      } else {
        showResult();
      }
    });
  }

  // Function to show the result (calculate average and display on the spectrum chart)
  function showResult() {
    // Calculate the average score
    const avg = scores.reduce((a, b) => a + b, 0) / scores.length;

    // Get the context of the canvas where the chart will be rendered
    const ctx = document.getElementById('spectrumChart').getContext('2d');

    // Create the chart
    new Chart(ctx, {
      type: 'scatter',  // Scatter chart for plotting a point
      data: {
        datasets: [{
          label: 'You are here →',
          data: [{ x: avg, y: 0 }], // Position the point on the x-axis based on average score
          backgroundColor: '#E74C3C',  // Red color for the point
          pointRadius: 8  // Size of the point
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            type: 'linear',
            position: 'bottom',
            min: 0,
            max: 10,
            title: {
              display: true,
              text: 'Not upset at all ← → Ferociously upset'
            },
            ticks: {
              stepSize: 1
            }
          },
          y: {
            display: false,  // Hide the y-axis
            min: -1,
            max: 1
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: (ctx) => `Score: ${ctx.raw.x.toFixed(1)}`
            }
          }
        }
      }
    });
  }

  // Initialize the first question
  renderQuestion();
</script>

<!-- CSS Styling -->
<style>
  /* General Page Styling */
  body {
    font-family: 'Arial', sans-serif;
    background-color: #A2DFF7; /* Light blue background */
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    text-align: center;
  }

  #quiz-container {
    background-color: #ffffff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    width: 80%;
    max-width: 600px;
    display: flex;
    flex-direction: column;  /* Stack elements vertically */
    align-items: center;     /* Center everything horizontally */
  }

  .question {
    margin-bottom: 20px;
    text-align: left;  /* Align question text to the left */
  }

  p {
    font-size: 16px;
    color: #333;
  }

  input[type="range"] {
    width: 70%;  /* Narrow the slider to fit nicely */
    margin: 10px 0;
    position: relative;
  }

  span {
    font-weight: bold;
  }

  /* Styling for the "Back" and "Next" buttons */
  button {
    background-color: #E74C3C;
    color: white;
    font-size: 16px;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 20px;
  }

  button:hover {
    background-color: #c0392b;
  }

  /* Styling the labels at the ends of the sliders */
  input[type="range"]::before {
    content: "Not upset at all";
    position: absolute;
    left: 0;
    top: -20px; /* Position above the slider */
    color: #333;
    font-size: 14px;
  }

  input[type="range"]::after {
    content: "Ferociously upset";
    position: absolute;
    right: 0;
    top: -20px; /* Position above the slider */
    color: #333;
    font-size: 14px;
  }

  /* Styling the result section */
  #result {
    margin-top: 30px;
    margin-bottom: 40px;
    width: 100%;  /* Ensure the canvas takes full width */
  }
</style>
